<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ° Kushan Empire</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #1a1a1a;
    color: #ffffff;
    padding: 20px;
    margin: 0;
}
h1, h2 {
    text-align: center;
}
button {
    padding: 8px 15px;
    margin: 5px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    font-weight: bold;
}
button:hover { opacity: 0.8; }
input {
    padding: 8px;
    margin: 5px 0;
    width: 100%;
    border-radius: 5px;
    border: 1px solid #ccc;
}
img { max-width: 200px; margin-top: 10px; border-radius: 5px; }
.entry {
    border: 1px solid #555;
    padding: 10px;
    margin-top: 10px;
    border-radius: 5px;
    background: #222;
    text-align: center;
}
#language-select button {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: #444;
    color: #fff;
}
#section-select button {
    background: #555;
    color: #fff;
}
.admin-btn { background: #ff4444; color: #fff; }
.delete-btn { background: #cc0000; color: #fff; margin-top: 5px; }
</style>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- Sprachwahl -->
<div id="language-select" style="text-align:center; margin-bottom:10px;">
    <button onclick="setLang('en')"><img src="https://flagcdn.com/us.svg" width="25"> English</button>
    <button onclick="setLang('fa')"><img src="https://flagcdn.com/ir.svg" width="25"> ÙØ§Ø±Ø³ÛŒ</button>
    <button onclick="setLang('dr')"><img src="https://flagcdn.com/af.svg" width="25"> Dari</button>
</div>

<h1>ğŸ° Kushan Empire</h1>

<!-- Abteilungsauswahl -->
<div id="section-select" style="text-align:center; margin-bottom:10px;">
    <button onclick="selectSection('kushan1')">ğŸ° Kushan 1 ğŸ”’</button>
    <button onclick="selectSection('kushan2')">ğŸ° Kushan 2 ğŸ”“</button>
</div>

<!-- MenÃ¼ -->
<div style="text-align:center; margin-bottom:10px;">
    <button onclick="neueDaten()">â• Add New Data</button>
    <button onclick="datenAnzeigen()">ğŸ“‚ View Saved Data</button>
    <button onclick="adminLogin()">ğŸ”‘ Admin Login</button>
</div>

<!-- Suche & Sortierung -->
<div style="text-align:center; margin-bottom:10px;">
    <input type="text" id="search" placeholder="Search attacker, target or alliance..." oninput="datenAnzeigen()">
    <select id="sortOrder" onchange="datenAnzeigen()">
        <option value="newest">Newest first</option>
        <option value="oldest">Oldest first</option>
    </select>
</div>

<hr>
<div id="inhalt"></div>

<!-- Statistik -->
<div id="stats" style="text-align:center; margin-top:20px;">
    <canvas id="attackChart" width="400" height="200"></canvas>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ===================== FIREBASE =====================
const firebaseConfig = {
  apiKey: "AIzaSyDQvWVcwDQivNGysnvfm4fBBykNbYtnDZc",
  authDomain: "castel-game.firebaseapp.com",
  databaseURL: "https://castel-game-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "castel-game",
  storageBucket: "castel-game.appspot.com",
  messagingSenderId: "504558378124",
  appId: "1:504558378124:web:f494c563b755454770efa9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===================== TEXTE =====================
const texts = {
    en: {
        title: "ğŸ° Kushan Empire",
        addData: "â• Add New Data",
        viewData: "ğŸ“‚ View Saved Data",
        newAttack: "New Attack",
        attackName: "Who attacked?",
        enterName: "Enter attacker name",
        attackTarget: "Who was attacked?",
        enterTarget: "Enter target name",
        attackAlliance: "Which alliance was attacked?",
        enterAlliance: "Enter alliance",
        uploadImage: "Please upload an image",
        save: "Save",
        noData: "No data available.",
        lastAttack: "Last attack",
        time: "Time",
        alertEnter: "Please fill all fields and upload an image!",
        alertSaved: "Data saved online!",
        wrongPassword: "âŒ Wrong password!",
        accessGranted: "âœ… Access granted to ",
        delete: "Delete"
    },
    fa: {
        title: "ğŸ° Ø§Ù…Ù¾Ø±Ø§ØªÙˆØ±ÛŒ Ú©ÙˆØ´Ø§Ù†",
        addData: "â• Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯",
        viewData: "ğŸ“‚ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡",
        newAttack: "Ø­Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯",
        attackName: "Ú†Ù‡ Ú©Ø³ÛŒ Ø­Ù…Ù„Ù‡ Ú©Ø±Ø¯ØŸ",
        enterName: "Ù†Ø§Ù… Ù…Ù‡Ø§Ø¬Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
        attackTarget: "Ø¨Ù‡ Ú†Ù‡ Ú©Ø³ÛŒ Ø­Ù…Ù„Ù‡ Ø´Ø¯ØŸ",
        enterTarget: "Ù†Ø§Ù… Ù‡Ø¯Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
        attackAlliance: "Ú©Ø¯Ø§Ù… Ø§ØªØ­Ø§Ø¯ Ù…ÙˆØ±Ø¯ Ø­Ù…Ù„Ù‡ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªØŸ",
        enterAlliance: "Ù†Ø§Ù… Ø§ØªØ­Ø§Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
        uploadImage: "Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ØªØµÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯",
        save: "Ø°Ø®ÛŒØ±Ù‡",
        noData: "Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª",
        lastAttack: "Ø¢Ø®Ø±ÛŒÙ† Ø­Ù…Ù„Ù‡",
        time: "Ø²Ù…Ø§Ù†",
        alertEnter: "Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯ Ùˆ ØªØµÙˆÛŒØ± Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯!",
        alertSaved: "Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯!",
        wrongPassword: "âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!",
        accessGranted: "âœ… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ",
        delete: "Ø­Ø°Ù"
    },
    dr: {
        title: "ğŸ° Ø§Ù…Ù¾Ø±Ø§ØªÙˆØ±ÛŒ Ú©ÙˆØ´Ø§Ù†",
        addData: "â• Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯",
        viewData: "ğŸ“‚ Ø¯ÛŒØ¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯Ù‡",
        newAttack: "Ø­Ù…Ù„Ù‡ Ø¬Ø¯ÛŒØ¯",
        attackName: "Ú†Ù‡ Ú©Ø³ÛŒ Ø­Ù…Ù„Ù‡ Ú©Ø±Ø¯ØŸ",
        enterName: "Ù†Ø§Ù… Ù…Ù‡Ø§Ø¬Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
        attackTarget: "Ø¨Ù‡ Ú†Ù‡ Ú©Ø³ÛŒ Ø­Ù…Ù„Ù‡ Ø´Ø¯ØŸ",
        enterTarget: "Ù†Ø§Ù… Ù‡Ø¯Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
        attackAlliance: "Ú©Ø¯Ø§Ù… Ø§ØªØ­Ø§Ø¯ Ù…ÙˆØ±Ø¯ Ø­Ù…Ù„Ù‡ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØªØŸ",
        enterAlliance: "Ù†Ø§Ù… Ø§ØªØ­Ø§Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
        uploadImage: "Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ØªØµÙˆÛŒØ± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯",
        save: "Ø°Ø®ÛŒØ±Ù‡",
        noData: "Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª",
        lastAttack: "Ø¢Ø®Ø±ÛŒÙ† Ø­Ù…Ù„Ù‡",
        time: "Ø²Ù…Ø§Ù†",
        alertEnter: "Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯ Ùˆ ØªØµÙˆÛŒØ± Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯!",
        alertSaved: "Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù†Ø¯!",
        wrongPassword: "âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!",
        accessGranted: "âœ… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ",
        delete: "Ø­Ø°Ù"
    }
};

// ===================== VARIABLEN =====================
let currentLang = 'en';
let currentSection = 'kushan2';
const KUSHAN1_PASSWORD = "12345";
let isAdmin = false;
const ADMIN_PASSWORD = "admin123";
const inhalt = document.getElementById("inhalt");

// ===================== SPRACHWECHSEL =====================
function setLang(lang){
    currentLang = lang;
    document.title = texts[lang].title;
    document.querySelector('h1').innerText = texts[lang].title;
    datenAnzeigen();
}

// ===================== ABTEILUNG =====================
function selectSection(section){
    if(section === "kushan1"){
        const pw = prompt("Enter password for Kushan 1:");
        if(pw !== KUSHAN1_PASSWORD){
            alert(texts[currentLang].wrongPassword);
            return;
        }
    }
    currentSection = section;
    alert(texts[currentLang].accessGranted + section.toUpperCase());
    datenAnzeigen();
}

// ===================== NEUE DATEN =====================
function neueDaten(){
    inhalt.innerHTML = `
        <h2>${texts[currentLang].newAttack}</h2>
        <p>${texts[currentLang].attackName}</p>
        <input type="text" id="attacker" placeholder="${texts[currentLang].enterName}">
        <p>${texts[currentLang].attackTarget}</p>
        <input type="text" id="target" placeholder="${texts[currentLang].enterTarget}">
        <p>${texts[currentLang].attackAlliance}</p>
        <input type="text" id="alliance" placeholder="${texts[currentLang].enterAlliance}">
        <p>${texts[currentLang].uploadImage}</p>
        <input type="file" id="bild" accept="image/*">
        <br><br>
        <button onclick="speichern()">${texts[currentLang].save}</button>
    `;
}

// ===================== DATEN SPEICHERN =====================
function speichern(){
    const attacker = document.getElementById("attacker").value;
    const target = document.getElementById("target").value;
    const alliance = document.getElementById("alliance").value;
    const bild = document.getElementById("bild").files[0];

    if(!attacker || !target || !alliance || !bild){
        alert(texts[currentLang].alertEnter);
        return;
    }

    const reader = new FileReader();
    reader.onload = function(){
        db.ref("castelDaten/"+currentSection).push({
            attacker: attacker,
            target: target,
            alliance: alliance,
            bild: reader.result,
            zeit: new Date().toLocaleString()
        });
        alert(texts[currentLang].alertSaved);
        datenAnzeigen();
    }
    reader.readAsDataURL(bild);
}

// ===================== DATEN ANZEIGEN + SUCHE/SORTIERUNG + STATISTIK =====================
function datenAnzeigen(){
    const searchValue = document.getElementById("search")?.value.toLowerCase() || '';
    const sortOrder = document.getElementById("sortOrder")?.value || 'newest';
    
    inhalt.innerHTML = `<h2>Saved Data â€“ ${currentSection.toUpperCase()}</h2>`;

    db.ref("castelDaten/"+currentSection).once("value", snapshot=>{
        const daten = snapshot.val();
        if(!daten){
            inhalt.innerHTML += `<p>${texts[currentLang].noData}</p>`;
            drawChart({});
            return;
        }

        const datenArray = Object.keys(daten).map(key => ({ key, ...daten[key] }));
        datenArray.sort((a, b) => {
            const dateA = new Date(a.zeit);
            const dateB = new Date(b.zeit);
            return sortOrder === 'newest' ? dateB - dateA : dateA - dateB;
        });

        const stats = {};

        datenArray.forEach(e => {
            if(
                e.attacker.toLowerCase().includes(searchValue) ||
                e.target.toLowerCase().includes(searchValue) ||
                e.alliance.toLowerCase().includes(searchValue)
            ){
                let html = `
                    <div class="entry">
                        <strong>${texts[currentLang].attackName}:</strong> ${e.attacker}<br>
                        <strong>${texts[currentLang].attackTarget}:</strong> ${e.target}<br>
                        <strong>${texts[currentLang].attackAlliance}:</strong> ${e.alliance}<br>
                        <small>${e.zeit} / ${texts[currentLang].time}</small><br>
                        <img src="${e.bild}"><br>
                `;
                if(isAdmin){
                    html += `<button class="delete-btn" onclick="deleteEntry('${e.key}')">${texts[currentLang].delete}</button>`;
                }
                html += `</div>`;
                inhalt.innerHTML += html;

                stats[e.attacker] = (stats[e.attacker] || 0) + 1;
            }
        });

        drawChart(stats);
    });
}

// ===================== DIAGRAMM =====================
function drawChart(stats){
    const ctx = document.getElementById('attackChart').getContext('2d');
    if(window.attackChartInstance) window.attackChartInstance.destroy();

    const labels = Object.keys(stats);
    const data = Object.values(stats);

    window.attackChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Number of Attacks',
                data: data,
                backgroundColor: 'rgba(255, 99, 132, 0.5)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, precision:0 }
            }
        }
    });
}

// ===================== ADMIN LOGIN =====================
function adminLogin(){
    const pw = prompt("Enter admin password:");
    if(pw === ADMIN_PASSWORD){
        isAdmin = true;
        alert("âœ… Admin access granted!");
        datenAnzeigen();
    } else{
        alert("âŒ Wrong password!");
    }
}

// ===================== DATEN LÃ–SCHEN =====================
function deleteEntry(key){
    if(!isAdmin){
        alert("âŒ Admin only!");
        return;
    }
    if(confirm("Do you really want to delete this entry?")){
        db.ref("castelDaten/"+currentSection+"/"+key).remove();
        datenAnzeigen();
    }
}

// ===================== AUTOMATISCH LADEN & REALTIME =====================
window.onload = () => {
    datenAnzeigen();
    db.ref("castelDaten/"+currentSection).on("value", datenAnzeigen);
}
</script>
</body>
</html>
